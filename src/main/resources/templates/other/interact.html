<!DOCTYPE html><html lang="en" style="height: 100%" xmlns:th="http://www.thymeleaf.org"><head>    <meta charset="UTF-8">    <title>课堂互动</title>    <meta name="renderer" content="webkit">    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">    <link rel="stylesheet" href="../../res/layui/css/layui.css" media="all">    <style>        .laytable-cell-1-pic {            height: 100%;        }    </style></head><body style="height: 100%"><div class="layui-container laytable-cell-1-pic">    <div class="layui-row laytable-cell-1-pic layui-col-space10">        <!--左边-->        <div id="leftDiv" class="layui-col-md3 layui-bg-green laytable-cell-1-pic"             style="position: relative">            <div onclick="preview('http://localhost:8080/classQRCode')" style="position: absolute;top: 50%;transform:translateY(-50%)">                <img style="width: 100%"                     src="http://bpic.588ku.com/element_origin_min_pic/00/03/09/995688861429f5a.jpg">            </div>            <div>                <button class="layui-btn layui-btn-danger" onclick="newTalk('新对话框')">添加对话框</button>            </div>            <br>            <div>                <button class="layui-btn layui-btn-danger" onclick="closeAll()">关闭所有对话框</button>            </div>        </div>        <!--右边-->        <div id="rightDiv" class=" layui-col-md9 layui-bg-cyan laytable-cell-1-pic            ">        </div>    </div></div><img alt="" style="display:none" id="displayimg" src="" /><input type="hidden" id="className" name="className" th:value="${className}"><script src="../../res/layui/layui.js"></script><script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script><!--负责layUI模块初始化--><script type="application/javascript">    var layer;    layui.use('layer', function () {        layer = layui.layer;    });</script><!--功能代码--><script type="application/javascript">    var talks = {};    function newTalk(id,content) {        // left 最小值        var talkLeftMin = $("#rightDiv").offset().left;        // left 最大值        var talkLeftMax = $("#rightDiv").offset().left + $("#rightDiv").width() - 100;        // top 最大值        var talkTopMax = document.body.clientHeight - 100;        // 对话框left坐标点        var talkLeft = Math.floor(Math.random() * (talkLeftMax - talkLeftMin + 1) + talkLeftMin);        // 对话框 top 坐标点        var talkTop = Math.floor(Math.random() * (talkTopMax - 0 + 1) + 0);        layer.open({             type: '0'            , offset: [talkTop, talkLeft]            , shade: 0            , content: content            , skin: 'layui-layer-molv'            , closeBtn: 0            , btn: ['已阅']            , success: function (layero,index) {                talks[index] = id;                console.log(talks);            }            , btn1: function (index,layero) {                 // todo 需从Redis中删除对应数据                layer.close(index);            }        });    }    function closeAll() {        layer.closeAll();    }    function preview(url) {        $("#displayimg").attr("src", url);        var height = $("#displayimg").height();        var width = $("#displayimg").width();        layer.open({            type: 1,            title: false,            closeBtn: 0,            shadeClose: true,            area: [width + 'px', height + 'px'], //宽高            content: "<img src=" + url + " />"        });    }    function startClass() {        // 建立课堂        // 添加该课堂的标识        var name = $("#className").val();        var data = {};        data.name = name;        alert(name);        $.ajax({            type: "POST",            url: "/startClass",            contentType: "application/json;charset=UTF-8",            dataType: "json",            data: JSON.stringify(data),            success: function (data) {                if (data.code !== 0) {                    alert('创建失败，请重新登录，或联系管理员');                    return false;                }                alert('创建成功')            }        });    }    function tipOverOrEnter() {        layui.use('layer', function () {            var layer = layui.layer;            layer.confirm('您有已存在的课堂，请选择将其覆盖，或是进入之前的课堂', {                    btn: ['覆盖', '进入之前的课堂'],                    closeBtn:0                },                function (index) {                    alert('覆盖');                    startClass();                    layer.close(index);                },                function (index) {                    alert('进入之前的课堂');                    $.ajax({                        type: "GET",                        url: "/talks",                        contentType: "application/json;charset=UTF-8",                        dataType: "json",                        success: function (data) {                            for (var value in data){                                // 迭代每一个键值对                                                                if (!(value.indexOf(".name") >= 0)) {                                    newTalk(value,data[value]);                                }else {                                    $("#className").val(data[value]);                                }                            }                        }                    });                    layer.close(index);                    return false;                }            );        });    }</script><script type="application/javascript">    // DOM加载完成之后需要完成的事情    $(function () {        // 进入页面后要判断当前用户在同一会话中是否已经存在课堂        // 如果存在需要让用户选择覆盖或者是直接进入        $.ajax({            type: "GET",            url: "/existClass",            contentType: "application/json;charset=UTF-8",            async: false,            dataType: "json",            success: function (data) {                var name = data.data.name;                if (name === null || name === '') {                    // 说明没有已存在的课堂，可以建立                    startClass();                } else {                    // 当前用户当前会话存在课堂，需让用户选择覆盖或直接进入                    tipOverOrEnter();                }            }        });    });</script></body></html>